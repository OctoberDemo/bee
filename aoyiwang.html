<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>奥一网蜜蜂</title>
    <script src="bee.js"></script>
</head>
<body>
<script>

    Bee.addChannel("国内", "广东", "http://3g.oeeee.com/m.php?s=/m2/gd/");
    Bee.addChannel("国内", "深圳", "http://3g.oeeee.com/m.php?s=/m2/szX/");
    Bee.setType("3g.oeeee.com");
    Bee.setImgReferer("3g.oeeee.com");
    Bee.setRefreshTime(1000 * 60 * 5);
    Bee.onListLoaded = function(dom) {
        Bee.scrollToBottom(dom);
        Bee.scrollToBottom(dom);
        Bee.scrollToBottom(dom);
        setTimeout(function() {
            var items = [];
            var contList = dom.byId("J_index_article");
            var lis = contList.byClasses("box-list");
            for (var i = 0; i < lis.length; i++) {
                var a = lis[i].byTag("a");
                var item = {};
                item.url = a.href;
                item.key = Bee.hashCode(item.url);
                item.title = a.byTag("h3").innerText;
                console.log(item.title);
                items.push(item);
            }
            console.log(items);
            Bee.finishExtractList(items);
        }, 500);
    };

    Bee.onItemLoaded = function(dom, item) {
        var pageButton = dom.byClass("loadmore", true);
        if (pageButton) {
            pageButton.click();
        }

        setTimeout(function() {
            console.log(dom);
            var article = dom.byClass("bd text1");
            if (article == undefined) {
                console.log("article == undefined");
                Bee.finishExtractItem();
                return;
            }
            var attribTags = dom.byClass("head clearfix");
            var souceString = attribTags.byClass("nickname").innerText.split("：")[1];
            console.log(souceString);
            if (souceString.indexOf("南方都市报") >= 0 ) {
                item.source = souceString;
            } else {
                Bee.passItem(item);
                return;
            }
            var timeString = (new Date()).getFullYear() + "-" + attribTags.byClass("time").innerText;
            item.created_at = Bee.convertTime(timeString);
            item.category = Bee.getCurCategory();
            console.log(timeString + " " + item.source);
            var content = Bee.htmlToJson(article);
            item.content = content;
            item.status = 3;
            item.class = "";

            Bee.finishExtractItem(item);
//            console.log(item);
        }, 1000);
    };

    Bee.start();
</script>
</body>
</html>