<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>新浪本地新闻蜜蜂</title>
    <script src="bee.js"></script>
</head>
<body>
<script>
    Bee.addChannel("", "上海|本地", "http://sh.sina.com.cn/news/b/list.shtml");
    Bee.addChannel("", "上海|各地", "http://sh.sina.com.cn/news/g/list.shtml");
    Bee.addChannel("", "上海|民生", "http://sh.sina.com.cn/news/m/list.shtml");
    Bee.addChannel("", "上海|社会", "http://sh.sina.com.cn/news/s/list.shtml");
    Bee.addChannel("", "上海|娱乐", "http://sh.sina.com.cn/news/w/list.shtml");
    Bee.addChannel("", "上海|体育", "http://sh.sina.com.cn/news/t/list.shtml");
    Bee.addChannel("", "上海|财经", "http://sh.sina.com.cn/news/economy/list.shtml");
    Bee.addChannel("", "上海|科教卫", "http://sh.sina.com.cn/news/k/list.shtml");

    Bee.addChannel("", "重庆|本地", "http://cq.sina.com.cn/news/b/list.shtml");
    Bee.addChannel("", "重庆|民生", "http://cq.sina.com.cn/news/m/list.shtml");
    Bee.addChannel("", "重庆|社会", "http://cq.sina.com.cn/news/s/list.shtml");
    Bee.addChannel("", "重庆|综合", "http://cq.sina.com.cn/news/z/list.shtml");
    Bee.addChannel("", "重庆|评论|热点", "http://cq.sina.com.cn/news/r/list.shtml");
    Bee.addChannel("", "重庆|娱乐|八卦", "http://cq.sina.com.cn/news/y/list.shtml");
    Bee.addChannel("", "重庆|体育", "http://cq.sina.com.cn/news/t/list.shtml");
    Bee.addChannel("", "重庆|经济", "http://cq.sina.com.cn/news/economy/list.shtml");
    Bee.addChannel("", "重庆|金融", "http://cq.sina.com.cn/news/finance/list.shtml");

    Bee.addChannel("", "天津|时政", "http://tj.sina.com.cn/news/b/list.shtml");
    Bee.addChannel("", "天津|本地|民生", "http://tj.sina.com.cn/news/m/list.shtml");
    Bee.addChannel("", "天津|社会|万象", "http://tj.sina.com.cn/news/s/list.shtml");
    Bee.addChannel("", "天津|综合", "http://tj.sina.com.cn/news/zhzx/list.shtml");
    Bee.addChannel("", "天津|文化|体育|生活", "http://tj.sina.com.cn/news/wtsh/list.shtml");
    Bee.addChannel("", "天津|经济", "http://tj.sina.com.cn/news/economy/list.shtml");
    Bee.addChannel("", "天津|金融", "http://tj.sina.com.cn/news/finance/list.shtml");
    Bee.addChannel("", "天津|法制", "http://tj.sina.com.cn/news/fzxc/list.shtml");

    Bee.addChannel("", "广东|本地", "http://gd.sina.com.cn/news/b/list.shtml");
    Bee.addChannel("", "广东|各地", "http://gd.sina.com.cn/news/m/list.shtml");
    Bee.addChannel("", "广东|深圳", "http://gd.sina.com.cn/news/sz/list.shtml");
    Bee.addChannel("", "广东|社会", "http://gd.sina.com.cn/news/s/list.shtml");
    Bee.addChannel("", "广东|便民", "http://gd.sina.com.cn/news/bm/list.shtml");
    Bee.addChannel("", "广东|港澳", "http://gd.sina.com.cn/news/ga/list.shtml");
    Bee.addChannel("", "广东|教育", "http://gd.sina.com.cn/news/xy/list.shtml");
    Bee.addChannel("", "广东|健康", "http://gd.sina.com.cn/news/jk/list.shtml");
    Bee.addChannel("", "广东|广州", "http://gd.sina.com.cn/news/gz/list.shtml");
    Bee.addChannel("", "广东|东莞", "http://gd.sina.com.cn/news/gd/list.shtml");
    Bee.addChannel("", "广东|佛山", "http://gd.sina.com.cn/news/fs/list.shtml");

    Bee.addChannel("", "河南|民生", "http://henan.sina.com.cn/news/m/list.shtml");
    Bee.addChannel("", "河南|综合", "http://henan.sina.com.cn/news/z/list.shtml");
    Bee.addChannel("", "河南|社会", "http://henan.sina.com.cn/news/s/list.shtml");
    Bee.addChannel("", "河南|经济", "http://henan.sina.com.cn/news/economy/list.shtml");
    Bee.addChannel("", "河南|金融", "http://henan.sina.com.cn/news/finance/list.shtml");

    Bee.addChannel("", "四川|成都", "http://sc.sina.com.cn/news/b/list.shtml");
    Bee.addChannel("", "四川|各地", "http://sc.sina.com.cn/news/m/list.shtml");
    Bee.addChannel("", "四川|社会", "http://sc.sina.com.cn/news/s/list.shtml");
    Bee.addChannel("", "四川|综合", "http://sc.sina.com.cn/news/z/list.shtml");
    Bee.addChannel("", "四川|评论", "http://sc.sina.com.cn/news/r/list.shtml");
    Bee.addChannel("", "四川|调查", "http://sc.sina.com.cn/news/d/list.shtml");
    Bee.addChannel("", "四川|评论", "http://sc.sina.com.cn/news/p/list.shtml");
    Bee.addChannel("", "四川|体育|娱乐", "http://sc.sina.com.cn/news/tiyu/list.shtml");
    Bee.addChannel("", "四川|经济", "http://sc.sina.com.cn/news/economy/list.shtml");
    Bee.addChannel("", "四川|金融", "http://sc.sina.com.cn/news/finance/list.shtml");
    Bee.addChannel("", "四川|城市", "http://sc.sina.com.cn/news/c/list.shtml");
    Bee.addChannel("", "四川|爱心", "http://sc.sina.com.cn/news/ymax/list.shtml");

    Bee.setType("http://www.sina.com.cn/");
    Bee.setImgReferer("http://www.sina.com.cn/");

    Bee.onListLoaded = function(dom) {
        var items = [];
        var listArticle = dom.byId("listArticle_page_0");
        var h3s = listArticle.byTags("h3");
        for (var i = 0; i < h3s.length; i++) {
            var a = h3s[i].byTag("a");
            var item = {};
            item.url = a.href;
            item.title = a.innerText;
            items.push(item);
        }
        Bee.finishExtractList(items);
    };

    Bee.onItemLoaded = function(dom, item) {
        var time_elem = dom.byClass("source-time");
        if (time_elem) { } else {
            Bee.passItem(item);
            return;
        }
        time_elem = time_elem.byTag("span");
        var time_string = time_elem.innerText.trim();
        var date_string = time_string.split(/\s/g)[0];
        var clock_string = time_string.split(/\s/g)[1];
        new Date(date_string.split('-')[0], date_string.split('-')[0], date_string.split('-')[0],)
        console.log(time_string);
        item.created_at = Bee.convertTime(time_string);

        var source_elem = time_elem.nextSibling.firstChild;
        if (source_elem) { } else {
            Bee.passItem(item);
            return;
        }
        item.source = source_elem.innerText;
        if (item.source.indexOf("新浪") < 0) {
            if (Bee.existSource(item.source)) {
                console.log("跳过来源：" + item.source);
                Bee.passItem(item);
                return;
            } else {
                console.log("未知来源：" + item.source);
            }
        }
        var content_elem = dom.byClass("article-body main-body", true);
        if (content_elem) { } else {
            Bee.passItem(item);
            return;
        }
        var page_elem = dom.byClass("page");
        if (page_elem) {
            var suburls = [];
            var next_pages = page_elem.byTags("a");
            for (var i = 0; i < next_pages.length - 1; ++i) {
                suburls.push(next_pages[i].href);
            }
            content_elem.removeClass("page");
            content_elem.removeClasses("article-video");
            content_elem.removeClasses("artice-pic");
            content_elem.removeClass("news_weixin_ercode clear tc");
            item.content = Bee.htmlToJson(content_elem);
            Bee.finishExtractSubUrls(suburls, item);
        } else {
            content_elem.removeClasses("article-video");
            content_elem.removeClasses("artice-pic");
            content_elem.removeClass("news_weixin_ercode clear tc");
            item.content = Bee.htmlToJson(content_elem);
            Bee.finishExtractItem(item);
        }
    };

    Bee.onSubItemLoaded = function(dom, item) {
        var content_elem = dom.byClass("article-body main-body");
        content_elem.removeClass("page");
        content_elem.removeClass("article-video artice-pic");
        content_elem.removeClass("news_weixin_ercode clear tc");
        var subContent = Bee.htmlToJson(content_elem);
        item.content = item.content.concat(subContent);

        var result = Bee.continueSubItem(item);
        if (result == false) {
            Bee.finishExtractItem(item);
        }
    };
    Bee.debug("http://henan.sina.com.cn/news/z/2015-12-24/detail-ifxmxxsr3584878.shtml")
//    Bee.start();
</script>
</body>
</html>