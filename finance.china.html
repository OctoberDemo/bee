<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>中国网财经频道蜜蜂</title>
    <script src="bee.js"></script>
</head>
<body>
<script>
    Bee.setType("http://finance.china.com.cn/");
    Bee.requestNoScript();
    Bee.requestNoIframe();
    Bee.addChannel("新闻", "滚动新闻_财经", "http://finance.china.com.cn/live.shtml");
    Bee.addChannel("新闻", "国内_财经", "http://finance.china.com.cn/news/gnjj/index.shtml");
    Bee.addChannel("新闻", "国际_财经", "http://finance.china.com.cn/news/gjjj/index.shtml");
    Bee.addChannel("新闻", "产经要闻_财经", "http://finance.china.com.cn/industry/hotnews/index.shtml");
    Bee.addChannel("新闻", "产经滚动_财经", "http://finance.china.com.cn/industry/live.shtml");
    Bee.addChannel("新闻", "产经原创_财经", "http://finance.china.com.cn/industry/my.shtml");
    Bee.addChannel("新闻", "产经公司_财经", "http://finance.china.com.cn/industry/company/index.shtml");
    Bee.addChannel("新闻", "产经人物_财经", "http://finance.china.com.cn/industry/renwu/index.shtml");
    Bee.addChannel("新闻", "产经房产_财经", "http://finance.china.com.cn/industry/estate/index.shtml");
    Bee.addChannel("新闻", "产经物流_财经", "http://finance.china.com.cn/industry/wl/index.shtml");
    Bee.addChannel("新闻", "产经环保_财经", "http://finance.china.com.cn/industry/hb/index.shtml");
    Bee.addChannel("新闻", "产经日化_财经", "http://finance.china.com.cn/industry/rh/index.shtml");
    Bee.addChannel("新闻", "财智_财经", "http://finance.china.com.cn/people/hotnews/index.shtml");
    Bee.addChannel("新闻", "外媒_财经", "http://finance.china.com.cn/news/wmkzg/index.shtml");
    Bee.addChannel("新闻", "消费_财经", "http://finance.china.com.cn/consume/hotnews/index.shtml");
    Bee.addChannel("新闻", "政策市场_财经", "http://finance.china.com.cn/consume/zcsc/index.shtml");

    Bee.setImgReferer("http://finance.china.com.cn/");
    Bee.setRefreshTime(60 * 60 * 1000);
    Bee.onListLoaded = function(dom) {
        var items = [];
        if (dom.byClass("news_list", true) != null) {
            var itemDivs = dom.byClass("news_list").byTags("li");
            for (var i = 0; i < itemDivs.length; i++) {
                var item = {};
                var tags = itemDivs[i].byTags("a", true);
                if (tags != null) {
                    var tag = tags[tags.length - 1];
                    item.title = tag.innerText;
                    item.url = tag.href;
                    item.key = Bee.hashCode(item.url);
                    items.push(item);
                }
            }
        }
        Bee.finishExtractList(items);
    }

    Bee.onItemLoaded = function(dom, item) {
        setTimeout(function() {
            var srcTag = dom.byId("source_baidu", true);
            if (srcTag != null) {
                var src = srcTag.innerText;
                src.replace("来源：","");
                if (src.search("中国网") < 0) {
                    if (Bee.existSource(src)) {
                        console.log("跳过来源：" + src);
                        Bee.passItem(item);
                        return;
                    } else {
                        console.log("未知来源：" + src);
                    }
                }
                item.source = src;
                var time = dom.byId("pubtime_baidu").innerText;
                time = time.replace("发布时间：","");
                item.created_at = Bee.convertTime(time);
                item.status = 3;
                if (dom.byId("content", true) != null) {
                    var content = Bee.htmlToJson(dom.byId("content"));
                    item.content = JSON.stringify(content);
                    Bee.finishExtractItem(item);
                } else {
                    Bee.passItem(item);
                }
            } else {
                Bee.passItem(item);
            }
        }, 1000)
    }
    Bee.start();
</script>
</body>
</html>